# install NFS packages if missing
echo '{{.Blue}}[INFO]{{.Reset}} Checking for nfs-kernel-server'
if ! dpkg -s nfs-kernel-server >/dev/null 2>&1; then
    apt-get update && apt-get install -y nfs-kernel-server nfs-common
fi

echo '{{.Blue}}[INFO]{{.Reset}} Creating export directory: {{.Root}}'
mkdir -p '{{.Root}}' && chown nobody:nogroup '{{.Root}}' && chmod 0777 '{{.Root}}'

echo '{{.Blue}}[INFO]{{.Reset}} Updating /etc/exports'
if ! grep -qs '{{.Root}}' /etc/exports; then
    echo '{{.Root}} {{.CIDR}}(rw,sync,no_subtree_check,no_root_squash)' >> /etc/exports
fi

exportfs -ra && exportfs -v
echo '{{.Green}}[SUCCESS]{{.Reset}} NFS export ready for clients in {{.CIDR}}'
